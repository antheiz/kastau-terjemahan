name: Deploy to GitHub Pages

on:
  push:
    branches:
      - gh-pages

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set Up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Build MkDocs
        run: mkdocs build

      # - name: Cache htmltest external links
      #   uses: actions/cache@v3
      #   with:
      #     path: tmp/.htmltest
      #     # key will contain hash of all md files to check if files have changed
      #     # when files are changed, a new key name is formed, and thus a new cache will be saved
      #     key: htmltest-${{ hashFiles('blog/**/*.md') }}
      #     # the restore key will fetch any previously saved cache even if there is no match on key
      #     # this allows to use cache from prev runs and update it
      #     restore-keys: |
      #       htmltest-

      # - name: htmltest
      #   uses: wjdp/htmltest-action@master
      #   with:
      #     config: blog/htmltest.yml

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site
